
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>FG-Shell Development &mdash; FutureGrid Rain 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.0/css/bootstrap-responsive.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-2.3.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="FutureGrid Rain 1.0.1 documentation" href="index.html" />
    <link rel="up" title="Rain Documentation" href="documentation.html" />
    <link rel="next" title="Changelog and Release Notes" href="changelog.html" />
    <link rel="prev" title="Building the Rain Documentation" href="build_doc.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
<div class="container">
  
  <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="index.html">FutureGrid Rain</a>
      <span class="navbar-text pull-left"><b>1.0.1</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="whatis.html">What is FutureGrid Rain?</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Rain QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Rain Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html#known-problems">Known problems</a></li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">FG-Shell Development</a><ul>
<li><a class="reference internal" href="#requirement">Requirement</a></li>
<li><a class="reference internal" href="#add-your-component-functionality-as-a-new-module">Add Your Component Functionality as a New Module</a></li>
<li><a class="reference internal" href="#contexts">Contexts</a></li>
<li><a class="reference internal" href="#log-file">Log File</a></li>
<li><a class="reference internal" href="#commit-the-changes">Commit the Changes</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          
          
            
  <li><a href="build_doc.html"
         title="previous chapter">&laquo; Building the Rain Documentation</a></li>
  <li><a href="changelog.html"
         title="next chapter">Changelog and Release Notes &raquo;</a></li>
          
          
            <li>
  <a href="_sources/dev_shell.txt"
     rel="nofollow">Source</a></li>
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

  
  <div class="section" id="fg-shell-development">
<span id="chap-dev-shell"></span><h1>FG-Shell Development<a class="headerlink" href="#fg-shell-development" title="Permalink to this headline">¶</a></h1>
<p>In this section we explain how to develop a new module for the FutureGrid Shell. More information can be found in the <a class="reference internal" href="man-shell.html#man-shell"><em>FutureGrid Shell Manual</em></a>.</p>
<div class="section" id="requirement">
<h2>Requirement<a class="headerlink" href="#requirement" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Download the FutureGrid code:</p>
<div class="highlight-python"><pre>git clone git@github.com:futuregrid/rain.git</pre>
</div>
</li>
<li><p class="first">Create a branch</p>
<div class="highlight-python"><pre>git checkout -b &lt;branch_name&gt;</pre>
</div>
</li>
<li><p class="first">Install in developer mode:</p>
<div class="highlight-python"><pre>sudo python setup.py develop</pre>
</div>
</li>
<li><p class="first">Copy configuration files from etc directory to /etc/futuregrid or to ~/.fg/  and set them up (:ref:admin)</p>
</li>
</ul>
</div>
<div class="section" id="add-your-component-functionality-as-a-new-module">
<h2>Add Your Component Functionality as a New Module<a class="headerlink" href="#add-your-component-functionality-as-a-new-module" title="Permalink to this headline">¶</a></h2>
<p>Next, we explain the steps needed to include a new module in the FutureGrid shell. As an example, we use the
repository module, called &#8220;repo&#8221;</p>
<ol class="arabic">
<li><p class="first">Create a file to develop your functionality. This file will be called fgShellRepo.py and will be located in
src/futuregrid/shell/ (change Repo with your module name). The file includes a class with the same name that inherits
from cmd2. See the fgShellRepo.py file for more details.</p>
</li>
<li><p class="first">Add your methods that has to be like &#8220;do_&lt;module&gt;&lt;method&gt;&#8221; i.e. do_repoget. In this way, in the shell we will have a
command called repoget. You can also include a method called help_repoget that show information when execute &#8220;help repoget&#8221;
in the shell.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These methods will not have functionality. They only are a new command line interface for your existing methods.
In the repository example, the functionality is in the class IRServiceProxy.</p>
</div>
</li>
<li><p class="first">Go to file fgCLI.py and make the fgShell class to inherit from your class. For that you have to do three steps</p>
<ul>
<li><p class="first">Import your class.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">futuregrid.shell.fgShellRepo</span> <span class="kn">import</span> <span class="n">fgShellRepo</span>
</pre></div>
</div>
</li>
<li><p class="first">Add it to the fgShell class.</p>
<div class="highlight-python"><pre>classfgShell(Cmd,
             fgShellUtils,
             fgShellRepo):</pre>
</div>
</li>
<li><p class="first">We have the list of available commands in a set called self.env to determine the available contexts (each module
will have a context, see section Contexts). Here you have to add the name of your context as a string. This variable
is in the constructor of the class fgShell (__init__(...)) and looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;repo&quot;</span><span class="p">,</span><span class="s">&quot;rain&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first">In the constructor we also have to write some information about the module.</p>
<div class="highlight-python"><pre>self.text = {'repo': 'Image Repository,
             'rain': 'FG Dynamic Provisioning'}</pre>
</div>
</li>
<li><p class="first">Next, we have to specify the modules that are required for the new. In this way, we only initialize the components
that the user needs. This is done in the do_use method (see next section Contexts) of the fgCLI.py file. Thus, we need
to add a condition and a list of requirements that the new module has. Note that the requirements strings MUST be as in
the name of the classes that usually have the first character in uppercase.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">arg</span><span class="o">==</span><span class="s">&quot;repo&quot;</span><span class="p">):</span>
   <span class="n">requirements</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Repo&quot;</span><span class="p">]</span>
<span class="k">elif</span> <span class="p">(</span><span class="n">arg</span> <span class="o">==</span> <span class="s">&quot;rain&quot;</span><span class="p">):</span>
   <span class="n">requirements</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Repo&quot;</span><span class="p">,</span><span class="s">&quot;Image&quot;</span><span class="p">,</span><span class="s">&quot;Rain&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Attention to the arguments of your methods. No matter how many arguments you have, all them are sent in a unique string.
Then, in your method you have to get them by using the  “getArgs(in: string): list” method, that is in the fgShellUtils class.</p>
</li>
<li><p class="first">In your class (fgShellRepo in this example) you will have an  __init__ method to initialize your module. However, it will
be called only if you change to your module&#8217;s context, see next Section.</p>
</li>
</ol>
</div>
<div class="section" id="contexts">
<h2>Contexts<a class="headerlink" href="#contexts" title="Permalink to this headline">¶</a></h2>
<p>We have created contexts make easier the use of the FutureGrid commands by removing the prefix of your module. For that we have
the show and use command. The show command list the available contexts and the use command change to a particular context. In this
way, we can change to the repo context by executing “use repo”. Note that the prompt change from “fg&gt;” to “fg-repo&gt;” Now, the get
command point to the repoget command.</p>
<p>We have already done several steps focused to enable the context. Here, we explain some other optional steps, but highly
recommendable. All this is done in the fgShellUtils.py file.</p>
<ol class="arabic">
<li><p class="first">If your have a command that is already in this class, you do not need to add anything to it.</p>
</li>
<li><p class="first">If your command is not in this class, you can add it by creating a method. For example, let assume that you have a hello method.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">do_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic get command that changes its behavior depending on the</span>
<span class="sd">    context specified with use command.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_use</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requirements</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s">&quot;self.do_&quot;</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&quot;hello(</span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">args</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">)&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">eval</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;There is no hello method in any of the active contexts (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requirements</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; )&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generic_error</span><span class="p">()</span>

<span class="n">help_hello</span> <span class="o">=</span> <span class="n">generic_help</span>
</pre></div>
</div>
</li>
<li><p class="first">This code will call a different method depending of the context. If your context is &#8220;repo&#8221;, you need to have a method called
do_repohello(args) in your fgShellRepo class.</p>
</li>
</ol>
</div>
<div class="section" id="log-file">
<h2>Log File<a class="headerlink" href="#log-file" title="Permalink to this headline">¶</a></h2>
<p>We have created a log file system to be use in the Shell. To use it, you only need to import the fgLog.py file:</p>
<p>from futuregrid.utils import fgLog
Then you can write in the logs using any of this methods:</p>
<div class="highlight-python"><pre>fgLog.degug(“text”)
fgLog.error(“text”)
fgLog.warning(“text”)
fgLog.info(“text”)</pre>
</div>
<p>The log file will be store in log file specified in the &#8220;fg-shell&#8221; section of the fg-client.conf configuration file. This file
is placed in /etc/futuregrid/ or in ~/.fg/</p>
</div>
<div class="section" id="commit-the-changes">
<h2>Commit the Changes<a class="headerlink" href="#commit-the-changes" title="Permalink to this headline">¶</a></h2>
<p>After you have created your new module, you need to push your branch into github and request to merge it with the official dev branch.</p>
<ol class="arabic">
<li><p class="first">Upload new branch to github</p>
<div class="highlight-python"><pre>git push origin &lt;branch_name&gt;</pre>
</div>
</li>
<li><p class="first">Send us a message via github to merge the code</p>
</li>
</ol>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011, Developed for FutureGrid by Javier Diaz, Fugang Wang, Gregor von Laszewski.<br/>
    </p>
  </div>
</footer>
  </body>
</html>